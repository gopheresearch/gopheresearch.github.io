<!DOCTYPE html>
<!--when swithcing to gohpher research the form action scr scr must be changed -->
<!--Written by Kashif Qureshi  qures072@umn.edu-->
<html>
<head>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.js">
    </script>
    <meta content="width = device-width, initial-scale = 1" name="viewport">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js">
    </script>
    <title></title>
</head>
<body style="background-color:#7a0019">
<!-- Modal Structure -->
<div class="modal" id="modal1" style=" top: 50%; left: 50%; width: 50%; transform: translate(-50%, -50%);">
    <div class="modal-content">
        <h4 style="text-align:center;">Having an issue?</h4>
        <h5 style="text-align:center;"><a href="https://docs.google.com/forms/d/e/1FAIpQLSfk-Z47Ban1pKW6IoU1feGOP2r_-2qQ4SEFFDQZhXfq-xIOhw/viewform" style="color:#7a0019;" target="_blank">Use the alternate form</a></h5><a href="mailto:gopheresearch@umn.edu" style="color:#7a0019;" target="_blank">Contact us</a><br>
        <br>
        <button class="btn waves-effect" onclick="window.open('https://gopheresearch.dl9.umn.edu/contact');" style="color:#7a0019; background-color:#ffcc33"><i class="material-icons" style="color:#7a0019">thumb_up</i></button> <button class="btn waves-effect" onclick="window.open('https://gopheresearch.dl9.umn.edu/contact');" style="color:#7a0019; background-color:#ffcc33"><i class="material-icons" style="color:#7a0019">thumb_down</i></button>
    </div>
    <div class="modal-footer" style="background-color:#7a0019; text-align:center">
        <a class=" modal-close waves-effect waves-green btn-flat" onclick="openHelpBox()" style="color:#ffcc33">Dismiss</a>
    </div>
</div>
<div class="modal modal-fixed-footer" id="fileModal" style=" top: 50%; left: 50%; width: 50%; transform: translate(-50%, -50%);">
    <div class="modal-content">
        <iframe frameborder="0" height="100%" id="filePreviewFrame" name="filePreviewFrame" src="" width="100%"></iframe>
    </div>
    <div class="modal-footer" style="background-color:#7a0019; text-align:center">
        <a class=" modal-close waves-effect waves-green btn-flat" onclick="filePreviewModal()" style="color:#ffcc33">Close</a>
    </div>
</div>
<div class="modal modal-fixed-footer" id="appPreviewModal" style=" top: 50%; left: 50%; width: 50%; transform: translate(-50%, -50%);">
    <div class="modal-content">
        <iframe frameborder="0" height="100%" id="appPreviewFrame" name="appPreviewFrame" src="" width="100%"></iframe>
    </div>
    <div class="modal-footer" style="background-color:#7a0019;">
        <a class="waves-effect waves-light btn" href="" id="saveBtnModal" style="color:#7a0019; background-color:#ffcc33;" type="button">Save a copy<i class=" material-icons right" style="color:#7a0019">cloud_download</i></a> <a class=" modal-close waves-effect waves-green btn-flat" onclick="previewAppModal()" style="color:#ffcc33">Close</a>
    </div>
</div>
<div id="cloneMeTemplate" style="display:none">
    <div class="col s10">
        <div class="file-field input-field" id="cloneME">
            <div class="btn" id="fileBtn" style="color:#7a0019; background-color:#ffcc33">
                <span>Browse</span>
                <div id="data"></div><input id="myFile" name="filename" onchange="realTimePreview(this)" type="file">
            </div>
            <div class="file-path-wrapper">
                <input class="file-path validate" id="dakkajsbjka" placeholder="Upload file" type="text">
            </div>
        </div>
    </div>
    <div class="col s2">
        <div class="center" style="padding-top:25px;">
            <a class="btn-floating btn-small waves-effect waves-light" id="previewbtnfile" onclick="openFilePreview(this)" style=" color:#7a0019; background-color:#7a0019; display:none;"><i class="material-icons">visibility</i></a> <!--<i class="close material-icons" onclick="deleteBox(this)" style="  cursor: hand; vertical-align: middle;">close</i>-->
            <a class="btn-floating btn-small waves-effect waves-light" onclick="deleteBox(this)" style="color:#7a0019; background-color:#7a0019"><i class="material-icons">close</i></a>
        </div>
    </div>
</div>
<div class="container">
    <div class="card-panel" id="card" style="background-color:#ffcc33">
        <h3 id="top" style="color:#7a0019">GopheResearch Application Form</h3>
        <div class="card-panel">
            <h3 id="top" style="color:#7a0019"><!--<span class="card-title" style="color:#7a0019 ">Details</span>--></h3>
            <div class="row">
                <h3 id="top" style="color:#7a0019"></h3>
                <div class="input-field col s6">
                    <h3 id="top" style="color:#7a0019"><i class="material-icons prefix">account_circle</i> <input class="validate" id="firstName" type="text"> <label for="firstName">First Name</label></h3>
                    <div class="input-field col s6">
                        <h3 id="top" style="color:#7a0019"><i class="material-icons prefix">account_circle</i> <input class="validate" id="lastName" type="text"> <label for="lastName">Last Name</label></h3>
                        <div class="row">
                            <h3 id="top" style="color:#7a0019"></h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <form>
            <div class="input-field col s6">
                <i class="material-icons prefix">mail</i> <input aria-required="true" class="validate" id="studentEmailAddress" required="" type="email" value="&lt;?= studentEmail ?&gt;"> <label for="studentEmailAddress">Student Email *</label>
            </div>
        </form>
        <form>
            <div class="input-field col s6">
                <i class="material-icons prefix">mail</i> <input aria-required="true" class="validate" id="piEmail" required="" type="email" value="&lt;?= piEmail ?&gt;"> <label for="piEmail">PI Email *</label>
            </div>
        </form>
    </div>
    <div class="row">
        <div class="input-field col s6" onchange="collegeSelected()">
            <i class="material-icons prefix">account_balance</i> <!-- MAKE DROPDOWN -->
            <select id="college">
                <option value="CBS">
                    CBS
                </option>
                <option value="CEHD">
                    CEHD
                </option>
                <option value="CLA">
                    CLA
                </option>
                <option value="CSE">
                    CSE
                </option>
                <option value="CSE">
                    CSE
                </option>
                <option value="School of Nursing">
                    School of Nursing
                </option>
                <option value="Medical School">
                    Medical School
                </option>
                <option value="Carlson School of Management">
                    Carlson School of Management
                </option>
                <option value="CFANS">
                    CFANS
                </option>
                <option value="Not listed">
                    Not listed
                </option>
            </select> <label>College</label>
        </div>
        <div class="input-field col s6" onchange="yearSelected()">
            <i class="material-icons prefix">person</i> <!-- MAKE DROPDOWN -->
            <select id="academicYear">
                <option value="Freshman">
                    Freshman
                </option>
                <option value="Sophomore">
                    Sophomore
                </option>
                <option value="Junior">
                    Junior
                </option>
                <option value="Senior">
                    Senior
                </option>
                <option value="Other">
                    Other
                </option>
            </select> <label>Academic Year</label>
        </div>
    </div>
    <div class="row">
        <div class="input-field col s6">
            <i class="material-icons prefix">school</i> <!-- MAKE DROPDOWN -->
            <input class="validate" id="academicMajor" type="text"> <label for="academicMajor">Major</label>
        </div>
        <div class="input-field col s6">
            <i class="material-icons prefix">school</i> <!-- MAKE DROPDOWN -->
            <input class="validate" id="minor" type="text"> <label for="minor">Minor</label>
        </div>
    </div>
</div>
<div class="card-panel">
    <span class="card-title center" style="color:#7a0019">Short Essay Responses (Optional)</span>
    <div class="row">
        <div class="input-field col s12">
            <i class="material-icons prefix">mode_edit</i>
            <textarea class="materialize-textarea validate" id="tellMeAboutYourself"></textarea> <label for="tellMeAboutYourself">Tell me about yourself</label>
        </div>
        <div class="input-field col s12">
            <i class="material-icons prefix">mode_edit</i>
            <textarea class="materialize-textarea validate" id="interested"></textarea> <label for="interested">Why are you interested in working with my lab?</label> <span class="helper-text">*Tip - Make this personalized to show you have done your homework! Professors will be impressed by your curiosity and the time you’ve taken to investigate their work.</span>
        </div>
        <div class="input-field col s12">
            <i class="material-icons prefix">mode_edit</i>
            <textarea class="materialize-textarea validate" id="gain"></textarea> <label for="gain">What would you like to gain from working in the lab?</label>
        </div>
        <div class="input-field col s12">
            <i class="material-icons prefix">mode_edit</i>
            <textarea class="materialize-textarea validate" id="goalsInterests"></textarea> <label for="goalsInterests">Describe your future career goals and/or project interests</label>
        </div>
        <div class="input-field col s12">
            <i class="material-icons prefix">mode_edit</i>
            <textarea class="materialize-textarea validate" id="experience"></textarea> <label for="experience">Relevant Experience and Coursework</label>
        </div>
        <div class="input-field col s12">
            <i class="material-icons prefix">mode_edit</i>
            <textarea class="materialize-textarea validate" id="addInformation"></textarea> <label for="addInformation">Additional Information</label> <span class="helper-text">Have anything else to share?</span> <!-- data-error="wrong" data-success="right" after "helper-text" === in span class to display error or success maessage -->
        </div>
    </div>
</div>
<div id="formcontainer">
    <form id="myForm" name="myForm">
        <!--FILE INPUT -->
        <!--<input type="file" name="filename" id="myFile" multiple> -->
        <div class="card-panel" id="fileCard">
            <span class="card-title center" style="color:#7a0019">Supporting Documents (Optional)</span>
            <div class="row" id="fileRow">
                <div id="cloneME">
                    <div class="col s10">
                        <div class="file-field input-field" id="cloneME">
                            <div class="btn" id="fileBtn" style="color:#7a0019; background-color:#ffcc33">
                                <span>Browse</span>
                                <div id="data"></div><input id="myFile" name="filename" onchange="realTimePreview(this)" type="file">
                            </div>
                            <div class="file-path-wrapper">
                                <input class="file-path validate" id="dakkajsbjka" placeholder="Upload file" type="text"> <label>Submit your Resumé, Cover letter, or Transcript if you wish. Please name your files accordingly.</label>
                            </div>
                        </div>
                    </div>
                    <div class="col s2">
                        <div class="center" style="padding-top:25px;">
                            <!--<previewbtn><i id="previewbtnfile" previewLink="nofile" class="material-icons" onclick="openFilePreview(this)" style="display:none;vertical-align: middle; color:#7a0019;" >visibility</i>  </previewbtn>-->
                            <a class="btn-floating btn-small waves-effect waves-light" id="previewbtnfile" onclick="openFilePreview(this)" style=" color:#7a0019; background-color:#7a0019; display:none;"><i class="material-icons">visibility</i></a> <!--<i class="close material-icons" onclick="deleteBox(this)" style="  cursor: hand; vertical-align: middle;">close</i>-->
                            <a class="btn-floating btn-small waves-effect waves-light" onclick="deleteBox(this)" style="color:#7a0019; background-color:#7a0019"><i class="material-icons">close</i></a>
                        </div>
                    </div>
                </div>
            </div><a class="btn-floating btn-large waves-effect waves center" onclick="createBox()" style="color:#7a0019; background-color:#7a0019"><i class="material-icons">add</i></a>
        </div><!--ProgressBar -->
        <div id="output"></div><!-- <div id="progressbar"></div> OLD PROGRESS BAR -->
        <div class="progress" id="progbox" style="display:none">
            <div class="indeterminate" id="prog1" style="width: 100%; background-color: #ffcc33;"></div>
        </div>
        <div class="progress-label" style="color: #ffcc33;"></div><!--SUBMIT BUTTON -->
        <div class="center">
            <!-- Preview Button -->
            <a class="waves-effect waves-light btn" id="previewbtn" onclick="previewAppModal()" style="color:#7a0019; background-color:#ffcc33" target="_blank" type="button">Preview<i class=" material-icons right" style="color:#7a0019">visibility</i></a><br>
            <br>
            <!--TEST COLLAPSIBLE-->
            <!--TEST -->
            <div id="previewDiv" style="display:none">
                <a class="waves-effect waves-light btn" href="" id="saveBtn" style="color:#7a0019; background-color:#ffcc33" type="button">Save a copy<i class=" material-icons right" style="color:#7a0019">cloud_download</i></a><br>
                <br>
                <iframe allowfullscreen frameborder="0" height="600px" id="previewFrame" marginheight="0px" marginwidth="0px" name="previewFrame" scrolling="yes" src="" style="border:0px #ffcc33 none;" width="100%"></iframe><br>
                <br>
            </div><a class="waves-effect waves-light btn-large disabled" id="btn" onclick="processRequestBack()" style="color:#7a0019; background-color:#ffcc33" type="button"><i class="material-icons right" style="color:#7a0019">send</i>Submit</a> <!--this is not needed-->
        </div>
    </form>
</div><br>
<form>
    <input id="uploadReady" onclick="successMessage1()" style="display: none" type="text">
</form>
<div class="center"></div><!--
            https://ihatetomatoes.net/demos/css3-preloader-transition/ - VERY COOL
            -->
<!-- Success Message --><!--Test Files -->
<div class="center" style="display:none">
    <a class="waves-effect waves-light btn-large" onclick="fileLogger()" style="color:#7a0019; background-color:#ffcc33" type="button"><i class=" material-icons right" style="color:#7a0019">send</i>Log Files</a>
</div><!-- TEST AREA <iframe src="https://docs.google.com/gview?url=http://remote.url.tld/path/to/document.doc&embedded=true"></iframe>-->
<!--===================================================================-->
<!--<embed  id="newBox"
   src="https://drive.google.com/file/d/179FNWnqjEt7Iex39gOnWj97ulp1F1QPk/preview"
   width="100%"
   height="600px"
   style ="display:none">

SRC blob:https://n-v5pxj4jjmungujw2ufkj4cxgagvqgb6qlyxusca-0lu-script.googleusercontent.com/8b716b73-37bb-764b-8c83-1924b0e94246-->
<div class="fixed-action-btn" id="helpbutton" onclick="openHelpBox()">
    <a class="btn-floating btn-large" style="background-color:#ffcc33"><i class="large material-icons" style="color:#7a0019">live_help</i></a>
</div>
<div class="row" id="helpbox" style=" text-align:center; display:none">
    <div class="col s6 m12">
        <div class="card" style="background-color:#7a0019">
            <div class="card-content" style="color:#ffcc33">
                <p>Having an Issue?</p>
            </div>
            <div class="card-action" style=" text-align:center; display:block">
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSfk-Z47Ban1pKW6IoU1feGOP2r_-2qQ4SEFFDQZhXfq-xIOhw/viewform" style="color:#ffcc33" target="_blank">Use this form</a> <a href="mailto:gopheresearch@umn.edu" style="color:#ffcc33" target="_blank">Contact us</a>
            </div>
        </div>
    </div><!-- TEST AREA -->
    <!-- FILE HANDLER SCRIPT STARTS -->
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js">
    </script>
    <script src="../mammoth.browser.js">
    </script>
    <script>








		      // /http://docs.google.com/gview?url=http://YOUR_FILE_PATH&embedded=true

		      function fileRender(elem){
		      //$(elem).parent('div').parent('div').parent('div').remove();
		      //If docx upload to drive and render
		      /*
		      var nodes = document.querySelectorAll("input[type=file]")
		      var allMyFiles =[]
		      for (var i=0; i<nodes.length; i++){
		        var input = nodes[i].files;
		        if(input.length != 0){
		        allMyFiles.push(Array.from(input));}
		      }

		      var finalFileList = []
		      for(var i=0; i<allMyFiles.length; i++){
		        finalFileList.push(allMyFiles[i][0])
		      }

		      console.log(finalFileList[0])
		      var box = document.getElementById('newBox')
		      var frame = document.getElementById('newFrame')

		      src= URL.createObjectURL(finalFileList[0])
		      console.log("SRC", src);
		      box.src = src

		      frame.src = src
		      */
		      console.clear()
		      console.log("fileRender")
		      var fileDiv = $(elem).parent('div').parent('div').parent('div');
		      var file = fileDiv.find("input")[0].files;
		      src= URL.createObjectURL(file[0]);

		      var name = file[0].name;
		      var fileExtension = name.replace(/^.*\./, '');


		      if(fileExtension == "doc" || fileExtension == "docx"){
		              M.toast({html: '.doc or .docx files may not be previewed at the moment ',classes: 'toast'});
		      }


		      document.getElementById('filePreviewFrame').src = src;


		      //Once we have it injected, open modal.
		      }


		      //................................Beautiful........................................//
		      function realTimePreview(inputElem){
		      console.clear();
		      //inputElem.setAttribute("previewLink", "Changed this previewLink");
		      //console.log("NEW", inputElem.getAttribute("previewLink"));
		      var file = inputElem.files[0];
		      //  console.log(file);

		      var fileDiv = $(inputElem).parent('div').parent('div').parent('div').parent('div');
		      var previewbtnDiv = fileDiv.find("previewbtn")[0];
		      var previewbtn = previewbtnDiv.children[0]
		      previewbtn.setAttribute("previewLink", "processing")


		      var reader = new FileReader();
		        reader.onload = function (e) {
		          var content = reader.result;
		          //console.log('Sending ' + file[0].name);
		          //var currFolder = 'Something';
		          google.script.run.withSuccessHandler(function(link) {
		          var tempID = link.match(/[-\w]{25,}/g);
		          var previewLink = "https://drive.google.com/file/d/" + tempID +"/preview";
		          //Set icon url Top-Down Navigation
		          previewbtn.setAttribute("previewLink", previewLink);
		          previewbtn.style.display = "inline-block";
		          //console.log("NEW", previewbtn.getAttribute("previewLink"))
		          }).previewFile(content, file.name);
		        }
		        reader.readAsDataURL(file);


		      }


		      function openFilePreview(elem){
		      var previewLink = elem.getAttribute("previewLink");
		      var fileModal = document.getElementById("fileModal");

		      if(fileModal.style.display == "none"){

		            document.getElementById('filePreviewFrame').src = previewLink;
		            fileModal.style.display = "block";
		      }

		      else{
		          fileModal.style.display = "none"
		      }
		      }
		      //................................Beautiful........................................//


		      function fileRenderFromDrive(elem){
		      //Bottom up ss
		      var fileDiv = $(elem).parent('div').parent('div').parent('div');
		      var file = fileDiv.find("input")[0].files;
		      src= URL.createObjectURL(file[0]);

		      var name = file[0].name;
		      var fileExtension = name.replace(/^.*\./, '');

		      //console.log(name)
		      var reader = new FileReader();
		      reader.onload = function (e) {
		        var content = reader.result;
		        console.log('Sending ' + file[0].name);
		        var currFolder = 'Something';
		        google.script.run.withSuccessHandler(function(link) {
		        var tempID = link.match(/[-\w]{25,}/g);
		        var previewLink = "https://drive.google.com/file/d/" + tempID +"/preview";
		        document.getElementById('filePreviewFrame').src = previewLink;


		        }).previewFile(content, file[0].name);
		      }
		      reader.readAsDataURL(file[0]);

		      }



		      function filePreviewModal(elem){

		        var fileModal = document.getElementById("fileModal");

		        if(fileModal.style.display == "none"){
		              //fileRender(elem); DOES NOT DISPLAY DOC FILES
		              fileRenderFromDrive(elem);
		                  fileModal.style.display = "block";

		            }
		            else{fileModal.style.display = "none"}
		      }



		      function collegeSelected(){

		      document.querySelector("body > div.container > div:nth-child(2) > div:nth-child(3) > div:nth-child(1) > div > input").style = "border-bottom: 2px solid #4cb04f;"
		      }

		      function yearSelected(){
		      /*.select-wrapper input.select-dropdown {
		            border-bottom: 2px solid #4cb04f;
		      }*/
		      document.querySelector("body > div.container > div:nth-child(2) > div:nth-child(3) > div:nth-child(2) > div > input").style = "border-bottom: 2px solid #4cb04f;"

		      }



		      function previewApp(){

		      var iframeElement = document.getElementById("previewDiv")
		            if(iframeElement.style.display == "block"){
		                  iframeElement.style.display = 'none';
		                        document.getElementById('previewbtn').innerHTML = "Preview<i class='material-icons right' style='color:#7a0019'>visibility<\/i>"

		                return;
		            }


		            document.getElementById('previewbtn').innerHTML = "Loading... "
		            M.toast({html: 'This may take some time. Please wait.',classes: 'toast'});



		                   var interested = document.getElementById("interested");
		                   var gain = document.getElementById("gain");
		                   var goalsInterests = document.getElementById("goalsInterests");
		                   var experience = document.getElementById("experience");
		                   var addInformation = document.getElementById("addInformation");

		                   var rawData = {
		                     firstName: document.getElementById("firstName").value,
		                     lastName: document.getElementById("lastName").value,
		                     studentEmailAddress: document.getElementById("studentEmailAddress").value,
		                     piEmail: document.getElementById("piEmail").value,
		                     college: document.getElementById("college").value,
		                     academicYear: document.getElementById("academicYear").value,
		                     academicMajor: document.getElementById("academicMajor").value,
		                     minor: document.getElementById("minor").value,
		                     tellMeAboutYourself: document.getElementById("tellMeAboutYourself").value,
		                     interested: document.getElementById("interested").value,
		                     gain: document.getElementById("gain").value,
		                     goalsInterests: document.getElementById("goalsInterests").value,
		                     experience: document.getElementById("experience").value,
		                     addInformation: document.getElementById("addInformation").value
		                   };

		      google.script.run.withSuccessHandler(function(link) {
		        var tempID = link.match(/[-\w]{25,}/g);
		        var openLink = "https://drive.google.com/file/d/" + tempID +"/preview";
		        document.getElementById('previewFrame').src = openLink;
		            document.getElementById("previewDiv").style.display = 'block'
		                       window.scrollTo(0,document.body.scrollHeight);

		               var downloadLink = "https://drive.google.com/uc?export=download&id=" + tempID;



		          document.getElementById('saveBtn').href = downloadLink;

		                             //window.open(openLink);
		              document.getElementById('previewbtn').innerHTML = "Close Preview<i class='material-icons right' style='color:#7a0019'>close<\/i>"


		              //document.getElementById('appPreviewFrame').src = openLink;
		              //document.getElementById('appPreviewModal').style.display = "block";


		                     }).previewApp(rawData);

		      }



		      function previewAppModal(){

		        var appPreviewModal = document.getElementById("appPreviewModal");

		        if(appPreviewModal.style.display != "none"){
		           appPreviewModal.style.display = "none"; return;
		          }

		      document.getElementById('previewbtn').innerHTML = "Loading... "
		      M.toast({html: 'This may take some time. Please wait.',classes: 'toast'});

		      var interested = document.getElementById("interested");
		      var gain = document.getElementById("gain");
		      var goalsInterests = document.getElementById("goalsInterests");
		      var experience = document.getElementById("experience");
		      var addInformation = document.getElementById("addInformation");

		      var rawData = {
		        firstName: document.getElementById("firstName").value,
		        lastName: document.getElementById("lastName").value,
		        studentEmailAddress: document.getElementById("studentEmailAddress").value,
		        piEmail: document.getElementById("piEmail").value,
		        college: document.getElementById("college").value,
		        academicYear: document.getElementById("academicYear").value,
		        academicMajor: document.getElementById("academicMajor").value,
		        minor: document.getElementById("minor").value,
		        tellMeAboutYourself: document.getElementById("tellMeAboutYourself").value,
		        interested: document.getElementById("interested").value,
		        gain: document.getElementById("gain").value,
		        goalsInterests: document.getElementById("goalsInterests").value,
		        experience: document.getElementById("experience").value,
		        addInformation: document.getElementById("addInformation").value
		      };

		      google.script.run.withSuccessHandler(function(link) {
		        var tempID = link.match(/[-\w]{25,}/g);
		        var openLink = "https://drive.google.com/file/d/" + tempID +"/preview";
		        //document.getElementById('previewFrame').src = openLink;
		        //document.getElementById("previewDiv").style.display = 'block'
		        window.scrollTo(0,document.body.scrollHeight);
		        var downloadLink = "https://drive.google.com/uc?export=download&id=" + tempID;
		        document.getElementById('saveBtnModal').href = downloadLink;
		        //window.open(openLink);
		        document.getElementById('appPreviewFrame').src = openLink;
		        //document.getElementById('appPreviewModal').style.display = "block";
		        appPreviewModal.style.display = "block";
		          document.getElementById('previewbtn').innerHTML = "Preview<i class='material-icons right' style='color:#7a0019'>visibility<\/i>"
		      }).previewApp(rawData);

		      }

		                    var numUploads = {};
		                    numUploads.done = 0;
		                    numUploads.total = 0;

		                    // Upload the files into a folder in drive
		                    // This is set to send them all to one folder (specificed in the .gs file)

		                    function iteratorFileUpload() {

		                    //------------//
		                        var nodes = document.querySelectorAll("input[type=file]")
		                        var allMyFiles =[]
		                        for (var i=0; i<nodes.length; i++){
		                          var input = nodes[i].files;
		                          if(input.length != 0){
		                            allMyFiles.push(Array.from(input));}
		                        }

		                        var finalFileList = []
		                        for(var i=0; i<allMyFiles.length; i++){
		                            finalFileList.push(allMyFiles[i][0])
		                        }
		                    //------------//

		                        //var allFiles = document.getElementById('myFile').files;
		                        var allFiles = finalFileList
		                      //if no adddiotnal files uploaded, we just create their folder and return.
		                        if(allFiles.length == 0){
		                          google.script.run.withSuccessHandler(folderReady1).createFolder(folderName);
		                          document.getElementById("uploadReady").click();
		                          return;
		                          }

		                      document.getElementById("progbox").style.display = 'block'

		                      numUploads.total = allFiles.length;
		                      $('#progressbar').progressbar({
		                      value : false
		                      });//.append("<div class='caption'>37%<\/div>");
		                      $(".progress-label").html('Preparing files for upload');

		                      //We must wait for folder to be created, before sending files.
		                      //It would work fine, but our directory will be cluttered.
		                      //There is a fucntion which always handles a conflict or sync. file stream here.
		                      google.script.run.withSuccessHandler(folderReady).createFolder(folderName);
		                      google.script.run.withSuccessHandler(updateProgressbar).uploadFileToDrive(content, file.name, folderName);

		                      function folderReady() {
		                        // Send each file at a time, I hate you google.
		                        for (var i = 0; i < allFiles.length; i++) {
		                          console.log(i);
		                          sendFileToDrive(allFiles[i]);
		                        }

		                      }
		                      function folderReady1() {
		                        console.log('No file uploaded');
		                        }


		                    }

		                    window.folderName = 'ApplicationID_' + Math.random().toString(36).substr(2, 9); //Global Variable, aka sessionID
		                    document.getElementById("btn").addEventListener("click", iteratorFileUpload);


		                    function sendFileToDrive(file) {
		                      var reader = new FileReader();
		                      reader.onload = function (e) {
		                        var content = reader.result;
		                        console.log('Sending ' + file.name);
		                        var currFolder = 'Something';
		                        google.script.run.withSuccessHandler(updateProgressbar).uploadFileToDrive(content, file.name, folderName);
		                      }
		                      reader.readAsDataURL(file);
		                    }


		                    function updateProgressbar( idUpdate ){
		                      console.log('Received: ' + idUpdate);
		                      numUploads.done++;
		                      var porc = Math.ceil((numUploads.done / numUploads.total)*100);
		                      $("#progressbar").progressbar({value: porc });
		                      $(".progress-label").text('Please Wait, Uploading ' + numUploads.done +'/'+ numUploads.total);
		                      if( numUploads.done == numUploads.total ){
		                         //uploadsFinished();
		                            $(".progress-label").text('Upload Complete');
		                         //Have to replace loader
		                         document.getElementById("prog1").className = "determinate";
		                         numUploads.done = 0;
		                         document.getElementById("uploadReady").click();
		                      };
		                    }



		</script>
    <script>
		                    function fileUploaded(status) {
		                      document.getElementById('myForm').style.display = 'none';
		                      document.getElementById('output').innerHTML = status;
		                    }

		</script> <!-- FILE HANDLER SCRIPT ENDS -->

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9">
    </script>
    <link href="sweetalert2.min.css" rel="stylesheet">
    <script>

		                    function successMessage1(){
		                      Swal.fire({
		                      title: "Good job!",
		                      text: "You will recieve an email shortly",
		                      icon: "success"
		                    });
		                    }

		                    //onclick="createBox(this.files.length)"
		                    function createBox(length){

		                    var itm = document.getElementById("cloneMeTemplate");
		                    var cln = itm.cloneNode(true);
		                    cln.style.display = "block";
		                    document.getElementById("fileRow").appendChild(cln);
		                    }

		                    function deleteBox(elem){
		                        $(elem).parent('div').parent('div').parent('div').remove();
		                    }


		                        function openHelpBox(){

		                    var moditm = document.getElementById("modal1");
		                    //var itm = document.getElementById("helpbox");
		                        //if(itm.style.display == "none"){itm.style.display = "block"}else{itm.style.display = "none"}
		                        if(moditm.style.display == "none"){moditm.style.display = "block";  } else{moditm.style.display = "none"}
		                       //window.scrollTo(0,document.body.scrollHeight);
		                    }

		</script>
</div><!-- FOOTER IS HIDDEN
            <div class="container" >

            <footer class="page-footer" >
                    <div class="footer-copyright" style="background-color:#ffcc33">
                      <div class="container">
                      © 2021 GopheResearch
                      <a class="grey-text text-lighten-4 right" href="#!">More Links </a>
                    </div>
            </footer>

            </div>

            FOOTER IS HIDDEN -->
<!--second to displaty on submit-->
<div class="st2">
    <div class="row">
        <div class="col s12">
            <div class="card blue-grey darken-1" id="card2" style="display: none">
                <div class="card-content white-text">
                    <span class="card-title"></span>
                    <h3 id="detail" style="color:white"><span class="card-title"></span></h3><!--
                                    but this does not guarantee an approval
                                    OLD = <h3 id= "detail" style="color:white" >

                                    -->
                    <h6 id="user" style="color:white;"></h6>
                </div>
                <div class="card-action">
                    <h6 style="color:white">Have a nice day, David!</h6><!--<a href="https://gopheresearch.umn.edu">Email Kashif</a></div>-->
                </div>
            </div>
        </div>
    </div>
</div>
<script>
	              //Displaying user, not really necessary. Put in body:    <h3 id="getUser"> Test <\/h3>
	               google.script.run
	                       .withSuccessHandler(updateField)
	                       .activeUser();
	               function updateField(output) {
	                   document.getElementById("getUser").innerHTML =  output;
	               }


	               document.addEventListener('DOMContentLoaded', function() {
	                 var butforce = document.getElementById("helpbutton");
	                 butforce.click(); //Not Ideal, figure out why its happening.
	                document.getElementById("previewbtnfile").click();
	                document.getElementById("previewbtn").click();



	                   var elems = document.querySelectorAll('select');
	                var instances = M.FormSelect.init(elems,  {accordion: false});

	                var prefilled = document.getElementById('piEmail');

	                if(prefilled.value.length != 0 ){
	                  prefilledValidate();
	                  }
	              var elems = document.querySelectorAll('.collapsible');
	      var instances = M.Collapsible.init(elems);
	               });



	              /* document.addEventListener('DOMContentLoaded', function() {
	                 var elems = document.querySelectorAll('select');
	                 var instances = M.FormSelect.init(elems,  {accordion: false});
	               }); */

	              //email validation
	               let emailFields = [document.getElementById('studentEmailAddress'),document.getElementById('piEmail') ]
	               emailFields.forEach(function(elem) {
	                   addEventListener('keyup', function (event) {

	                     if ( emailFields[0].checkValidity() && emailFields[1].checkValidity()) {
	                       //document.getElementById("btn").disabled = false;
	                                 document.getElementById("btn").className = "waves-effect waves-light btn-large";


	                     } else {
	                       //document.getElementById("btn").disabled = true;
	                       document.getElementById("btn").className = "waves-effect waves-light btn-large disabled";

	                     }

	                 });
	               });


	              function prefilledValidate(){
	                //This is for prefilled forms only
	                emailFields[0].focus();
	                emailFields[1].focus();
	                document.activeElement.blur();
	                document.getElementById("btn").className = "waves-effect waves-light btn-large";
	              }

	                function successMessage(){


	                   document.getElementById("top").innerHTML = "Success! ";
	                   //document.getElementById("top").style.textAlign= "left";
	                   document.getElementById("top").style.color  = "navy" ;
	                   document.getElementById("card").className  = "card-panel light-green accent-3" ;
	                   //document.getElementById("card2").style.display = 'block';
	                   window.scrollTo(0, 0);
	                   //document.getElementById("modal1").style.display = 'block';
	                   M.toast({html: 'You will recieve an email shortly.'});
	                   //M.updateTextFields(); - now used inEventlistener to refresh prefilled forms


	               }







	               function processRequestBack(){
	           window.scrollTo(0,document.body.scrollHeight);
	                 var firstName = document.getElementById("firstName");
	                 var lastName = document.getElementById("lastName");
	                 var studentEmailAddress = document.getElementById("studentEmailAddress");
	                 var piEmail = document.getElementById("piEmail");
	                 var college = document.getElementById("college");
	                 var academicYear = document.getElementById("academicYear");
	                 var academicMajor = document.getElementById("academicMajor");
	                 var minor = document.getElementById("minor");
	                 var tellMeAboutYourself = document.getElementById("tellMeAboutYourself");
	                 var interested = document.getElementById("interested");
	                 var gain = document.getElementById("gain");
	                 var goalsInterests = document.getElementById("goalsInterests");
	                 var experience = document.getElementById("experience");
	                 var addInformation = document.getElementById("addInformation");
	                 var allFiles = fileLogger()[0];
	                  var allFilesSize = fileLogger()[1];


	                 var rawData = {
	                   firstName: firstName.value,
	                   lastName: lastName.value,
	                   studentEmailAddress: studentEmailAddress.value,
	                   piEmail: piEmail.value,
	                   college: college.value,
	                   academicYear: academicYear.value,
	                   academicMajor: academicMajor.value,
	                   minor: minor.value,
	                   tellMeAboutYourself: tellMeAboutYourself.value,
	                   interested: interested.value,
	                   gain: gain.value,
	                   goalsInterests: goalsInterests.value,
	                   experience: experience.value,
	                   addInformation: addInformation.value,
	                   folder1: folderName,
	                   totalUploads: allFiles.length,
	                   totalUploadSize: allFilesSize
	                 };

	                 google.script.run.applicationHandler(rawData);

	              console.log("BACKENDINVOKED")

	              console.log("processRequestBack")
	              console.log(fileLogger()[0])

	              console.log("processRequestBackSIZE")
	              console.log(fileLogger()[1])

	               }



	                function fileLogger(){

	                  var nodes = document.querySelectorAll("input[type=file]")
	                  var allMyFiles =[]
	                  for (var i=0; i<nodes.length; i++){
	                    var input = nodes[i].files;
	                    if(input.length != 0){
	                      allMyFiles.push(Array.from(input));}
	                  }

	                  var finalFileList =[]
	                  for(var i=0; i<allMyFiles.length; i++){
	                      finalFileList.push(allMyFiles[i][0])
	                  }

	                  //console.log("2FILELIST");
	                  //console.log(allMyFiles[0].concat(allMyFiles[1]))

	                  //console.log("finalFileList");
	                  //console.log(finalFileList)

	                  var totalUploadSize = 0;
	                  for(var i=0; i<finalFileList.length; i++){
	                        var tempFileSize = finalFileList[i].size / (1048576)
	                        totalUploadSize = totalUploadSize + tempFileSize;
	                      }

	                  var totalUploadSizeMb = Math.round(totalUploadSize * 100) / 100;
	              //console.log(totalUploadSizeMb+' MB')
	                  return [finalFileList,totalUploadSizeMb] ;

	              }




	              //reset form



	</script>
<style>

	   .toast{
	    background-color: #ffcc33;
	    color: #7a0019;
	   }





	    //Select custom css//
	   /*.select-wrapper input.select-dropdown {
	         border-bottom: 2px solid #4cb04f;
	   }*/


	              .placeholder {
	              /* Chrome, Firefox, Opera, Safari 10.1+ */
	              color: red;
	              opacity: 1; /* Firefox */
	              }
	              .dropdown-content li > a, .dropdown-content li > span {
	              color: #7a0019;
	              }
	              /* label color */
	              .input-field label {
	              color: #7a0019 ;
	              }
	              /* icon prefix focus color */
	              .input-field .prefix.active {
	              color: #7a0019;
	              }
	              .removeFile {
	              display: block;
	              top: 50%;
	              left: 580%;
	              margin-top: 100%;
	              }
	              .modal {
	              z-index: 100;
	              }
	              .st2 {
	              margin: 0;
	              position: absolute;
	              top: 50%;
	              left: 50%;
	              -ms-transform: translate(-50%, -50%);
	              transform: translate(-50%, -50%);
	              }
	              .approved {
	              text-align: center;
	              }
	              .page-footer {
	              padding-top: 0px;
	              color: #e8eaf6;
	              background-color: blue-grey;
	              }
	              .wrapper {
	              text-align: center;
	              position: absolute;
	              left:50%;
	              }
	              .button {
	              position: absolute;
	              top: 90%;
	              left: 50%;
	              .bodytest{
	              className: container;
	              }
	              }
	              h3 {text-align: center; }
	              p {text-align: center;}
	              .center {
	              display: block;
	              margin-left: auto;
	              margin-right: auto;
	              width: 100%;
	              .centeredMessage {
	              position: fixed;
	              top: 50%;
	              left: 50%;
	              margin-top: -50px;
	              margin-left: -100px;
	              }
	              /* FILE HANDLER STYLES START*/
	              body {
	              max-width: 400px;
	              padding: 20px;
	              margin: auto;
	              }
	              input {
	              display: inline-block;
	              width: 100%;
	              padding: 5px 0px 5px 5px;
	              margin-bottom: 10px;
	              -webkit-box-sizing: border-box;
	              ‌​ -moz-box-sizing: border-box;
	              box-sizing: border-box;
	              }
	              /*select {
	              margin: 5px 0px 15px 0px;
	              }*/
	              input[type="submit"] {
	              width: auto !important;
	              display: block !important;
	              }
	              input[type="file"] {
	              padding: 5px 0px 15px 0px !important;
	              }
	              #progressbar{
	              width: 100%;
	              text-align: center;
	              overflow: hidden;
	              position: relative;
	              vertical-align: middle;
	              }
	              .progress-label {
	              float: left;
	              margin-top: 5px;
	              font-weight: bold;
	              text-shadow: 1px 1px 0 #fff;
	              width: 100%;
	              height: 100%;
	              position: absolute;
	              vertical-align: middle;
	              }
	              /* FILE HANDLER STYLES END*/
	</style><!-- Form validation example
            <div class="row">
              <form class="col s12">
                <div class="row">
                  <div class="input-field col s12">
                    <input id="email2" type="email" class="validate" required="" aria-required="true">
                    <label for="email2">Email</label>
                  </div>
                  <div class="input-field col s12">
                    <input id="example" name="example" type="text" class="validate" required="" aria-required="true">
                    <label for="example">Field</label>
                  </div>
                  <div class="input-field col s12">
                    <select required="" aria-required="true">
            <option value="" disabled selected>Choose your option</option>
            <option value="1">Option 1</option>
            <option value="2">Option 2</option>
            <option value="3">Option 3</option>
            </select>
                    <label>Materialize Select</label>
                  </div>
                  <div class="input-field col s12">
                    <button class="btn waves-effect waves-light" type="submit" name="action" on submit="processRequestFront()">Submit</button>
                  </div>
                </div>
              </form>
            </div>
            -->
</body>
</html>
